# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

ZIBENE SECURITY is a Flutter mobile application for booking certified bodyguards. It features a dual-shell architecture with separate client and admin interfaces, built with Firebase for backend services including Authentication, Cloud Firestore, and Cloud Storage.

## Development Commands

### Setup
```bash
# Install dependencies
flutter pub get

# Configure Firebase (one-time setup)
flutterfire configure

# Run the app with optional Stripe key
flutter run --dart-define=STRIPE_PUBLISHABLE_KEY=YOUR_STRIPE_PK

# Run on specific platform
flutter run -d chrome         # Web
flutter run -d android        # Android
flutter run -d ios           # iOS
```

### Development Tools
```bash
# Run tests
flutter test

# Run specific test file
flutter test test/widget_test.dart

# Code analysis
flutter analyze

# Build for production
flutter build apk --release
flutter build ios --release
flutter build web --release

# Clean build cache
flutter clean
flutter pub get
```

## Architecture

### Core Structure
- **Dual Navigation Shells**: Client shell (Home, Agents, Bookings, Profile) and Admin shell (Dashboard, Agents, Users, Reports)
- **Provider-based State Management**: Uses Provider for state management across 7 main providers orchestrated by MainProvider
- **Service Layer**: Separate services for Firebase, Auth, Notifications, Payments, and Location
- **Dark Theme Focus**: App defaults to dark theme with custom color scheme (#121212 background, #FFC107 yellow accent)
- **Firebase Backend**: Uses Firebase Authentication, Cloud Firestore, and Firebase Storage for data persistence

### Key Components

#### Services (`lib/services/`)
- `firebase_service.dart`: Centralized Firebase service with Firestore, Auth, and Storage
- `auth_service.dart`: Firebase Authentication service with email verification and persistence management
- `notification_service.dart`: Local and push notifications using flutter_local_notifications and Firebase Messaging
- `payment_service.dart`: Stripe integration for payment processing
- `location_service.dart`: Geolocation and mapping functionality
- `route_service.dart`: Route planning and navigation
- `persistence_service.dart`: Data persistence and caching
- `temp_data_service.dart`: Mock data service for development

#### Providers (`lib/providers/`)
- `main_provider.dart`: Orchestrates all other providers and handles initialization
- `auth_provider.dart`: User authentication and role management
- `booking_provider.dart`: Booking CRUD operations and status management
- `user_provider.dart`: User and agent profile management
- `notification_provider.dart`: Notification state management
- `payment_provider.dart`: Payment processing state
- `location_provider.dart`: Location and mapping state
- `agent_provider.dart`: Agent search and filtering logic

#### Screen Structure (`lib/screens/`)
- `shells/`: Client and Admin navigation shells with role-based routing
- `auth/`: Authentication screens (welcome, login, signup, forgot password, verify email)
- `user/`: Client-facing screens (home, agents search, bookings, profile, reviews, etc.)
- `admin/`: Admin management screens (dashboard, agents/users management, reports, alerts, etc.)

#### Models (`lib/models/`)
- Unified data models for users, agents, bookings, payments, notifications, and reviews
- Consistent data structure with proper serialization and validation

#### Database Schema
The app uses Firestore with these core collections:
- `users`: User accounts with role-based access (client/agent/admin)
- `agent_profiles`: Extended agent information (skills, certifications, rates)
- `bookings`: Service bookings with status tracking and real-time updates
- `payments`: Payment records with Stripe integration and transaction history
- `reviews`: Client ratings and feedback for agents
- `notifications`: User notifications with various types and priority levels

### Firebase Setup
1. **Firebase Project**: Created through Firebase Console with Authentication, Firestore, and Storage enabled
2. **Configuration**: Handled automatically via `firebase_options.dart` generated by `flutterfire configure`
3. **Security Rules**: Firestore security rules control data access permissions
4. **Collections**: Automatically created when first used

### Environment Configuration
Optional environment variable (passed via --dart-define):
- `STRIPE_PUBLISHABLE_KEY`: Stripe publishable key (payments functionality)

### Key Dependencies
- **State Management**: provider ^6.1.2
- **Firebase**: firebase_core, firebase_auth, cloud_firestore, firebase_storage, firebase_messaging
- **Maps**: flutter_map ^6.1.0, latlong2 ^0.9.1, location ^6.0.2
- **Payments**: flutter_stripe ^11.2.0
- **Notifications**: flutter_local_notifications ^17.0.1
- **UI**: shimmer ^3.0.0, lottie ^3.1.2, cached_network_image ^3.3.1

### Role-Based Access Control
Three user roles with different capabilities:
- **Client**: Book agents, view profiles, manage bookings
- **Agent**: Manage profile, view bookings, receive notifications
- **Admin**: Full access to dashboard, user management, reports, system monitoring

### Color Scheme
- Primary: #FFC107 (Yellow)
- Background: #121212 (Dark)
- Secondary: #FFD740 (Yellow accent)
- Status colors: #4CAF50 (success), #F44336 (error), #FF9800 (warning)

## Development Notes

- Firebase configuration is handled automatically via `firebase_options.dart` generated by `flutterfire configure`
- All database permissions are enforced through Firestore security rules
- The app uses Provider for state management with MainProvider orchestrating initialization
- Offline support enabled with Firestore persistence and auth persistence management
- Real-time updates through Firestore snapshots
- Mock data service available for development (`lib/services/temp_data_service.dart`)
- Internationalization support built-in with `app_translations.dart`
- Route management handled through `routes.dart` with navigation utilities
- Responsive UI components using `responsive_utils.dart`
- Theme configuration in `theme.dart` with dark theme as default
- App initialization handled by `app_initializer.dart` service
- Authentication wrapper (`auth_wrapper.dart`) manages user session and role-based routing
- Environment configuration through `env.dart` for different deployment stages